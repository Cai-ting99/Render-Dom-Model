!function(){"use strict";var t={63:function(t,e,o){var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,o=1,r=arguments.length;o<r;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var i=o(152),n=o(475),s=function(){function t(t,e){this.HtmlElementKey="",this.AttrModel=null,this.ParentDom=null,this.DomModels=[],this.Item=null,this.ModelProp=[],this.Module=null,this.Dom=null,this.IsLoad=!1,this.Index=0,this.ForLocation={Action:""},this.ContinueTorender=!0,this.ChildDom={},this.ContinuetoCycle=!0,this.ChildDomArr=[],this.DomModels=t,this.Module=e,this.ChildDomArr.RDMProp=!0}return t.prototype.setLoadState=function(t){return this.IsLoad=t,this},t.prototype.setHtmlModelProp=function(t){return this.ModelProp=t,this},t.prototype.setHtmlElementKey=function(t){return this.HtmlElementKey=t,this},t.prototype.setAttrModel=function(t){return this.AttrModel=t,this},t.prototype.setForItem=function(t){return this.Item=t,this},t.prototype.setForIndex=function(t){return this.Index=t,this},t.prototype.setParentDom=function(t){return this.ParentDom=t,this},t.prototype.setContinuetoCycle=function(t){return this.ContinuetoCycle=t,this},t.prototype.setForLocation=function(t){return this.ForLocation=t,this},t.prototype.DiffAttrModel=function(){var t=this.Module.Rander(),e=i.GetValueByPropStr(this.ModelProp.join("."),t),o={};for(var n in this.AttrModel)Array.isArray(e[n])||"function"==typeof e[n]||(this.AnalysisSpecificAttr(n,e),e[n].hasOwnProperty("Prop")?e[n].BindStr===this.AttrModel[n].BindStr&&e[n].model===this.AttrModel[n].model&&this.Dom[n]===e[n].model||(o[n]=e[n],this.AttrModel[n]=e[n]):e[n].toString()!==this.AttrModel[n].toString()&&(o[n]=e[n],this.AttrModel[n]=e[n]));var s=this.AttrModel;void 0!==o.if&&(o=r(r({},this.AttrModel),o)),this.setAttrModel(o),this.DecorateDomAttr(),this.setAttrModel(s)},t.prototype.RanderIf=function(){var t;"false"===this.AttrModel.if.toString()?(t=document.createComment(""),this.IsLoad?this.Dom.parentElement.replaceChild(t,this.Dom):this.Dom=t,this.ContinueTorender=!1):(t=document.createElement(this.HtmlElementKey.replace(/_/g,"").replace(/[0-9]/g,"")),this.IsLoad?this.Dom.parentElement.replaceChild(t,this.Dom):this.Dom=t,this.ContinueTorender=!0),this.Dom=t},t.prototype.RanderFunc=function(t){if(this.Item){var e=this;this.AttrModel[t]=(o=this.AttrModel[t],function(t){o.apply(this,[e.Item[e.AttrModel.itemas],e.Index,t])})}var o;this.Dom.addEventListener(t,this.AttrModel[t])},t.prototype.RanderBind=function(t){var e=this;this.Dom[t]!==this.AttrModel[t].model&&(this.Dom[t]=this.AttrModel[t].model);var o="input";"SELECT"===this.Dom.nodeName&&(o="change");var r=function(){e.AttrModel[t].Prop.Item[e.AttrModel[t].Prop.key]=e.Dom.value};this.Dom.removeEventListener(o,r),this.Dom.addEventListener(o,r)},t.prototype.AnalysisSpecificAttr=function(t,e){if(void 0===e.if||"false"!==e.if.toString()){if(e[t].hasOwnProperty("Bind")){var o=this.Module;e[t].Bind.match(/\<.*?\>/gi)&&(o=this.Item),e[t]=i.GetValueByPropStr(e[t].Bind,o,!0)}if("string"==typeof e[t]){var r=e[t].match(/\<.*?\>/gi);if(r){this.OldAttrStr=e[t];for(var n=0;n<r.length;n++)e[t]=e[t].replace(r[n],i.GetValueByPropStr(r[n].substring(1,r[n].length-1),this.Item))}}}},t.prototype.DecorateDomAttr=function(){var e=this,o=[];o.RDMProp=!0;var n=function(n){if(i.IsTagModel(s.AttrModel[n])&&!s.ChildDom.hasOwnProperty(n))return s.ChildDom[n]=new t(s.DomModels,s.Module).setHtmlModelProp(s.ModelProp.concat(n)).setHtmlElementKey(n).setAttrModel(r({},s.AttrModel[n])).setForItem(s.Item).setParentDom(s.Dom).builder(),"continue";if(s.ChildDom.hasOwnProperty(n)){if(Array.isArray(s.ChildDom[n]))for(var a=0;a<s.ChildDom.length;a++)s.ChildDom[a].setForItem(s.Item).setLoadState(!0).builder(!0);else s.ChildDom[n].setForItem(s.Item).setLoadState(!0).builder(!0);return"continue"}if(!Array.isArray(s.AttrModel[n])&&"itemas"!==n){if(s.AnalysisSpecificAttr(n,s.AttrModel),"if"===n&&s.RanderIf(),!s.ContinueTorender)return"continue";switch(n){case"show":s.Dom.style.display="false"===s.AttrModel[n].toString()?"none":"";break;case"style":s.Dom.setAttribute("style",s.AttrModel[n]);break;case"title":var l=Array.from(s.Dom.childNodes).find((function(t){return"#text"===t.nodeName}));l?l.textContent=s.AttrModel[n]:s.Dom.appendChild(document.createTextNode(s.AttrModel[n]));break;default:"function"!=typeof s.AttrModel[n]||s.IsLoad?s.AttrModel[n].hasOwnProperty("Prop")?o.push((function(){e.RanderBind(n)})):"if"!==n&&"f"!==n&&(s.Dom[n]=s.AttrModel[n]):s.RanderFunc(n)}s.OldAttrStr&&(s.AttrModel[n]=s.OldAttrStr,s.OldAttrStr=null)}},s=this;for(var a in this.AttrModel)n(a);for(var l=0;l<o.length;l++)o[l]()},t.prototype.builder=function(e){var o,s,a=this;if(void 0===e&&(e=!1),i.IsForTagModel(this.AttrModel)&&this.ContinuetoCycle){if(!this.AttrModel.itemas)throw new Error("在 "+this.ModelProp.join(".")+" 下未找到相应的 itemas 的别名");var l=n.default.$DomForTempLate.length;n.default.$DomForTempLate.push({key:this.ModelProp.join("."),AttrModel:this.AttrModel,arr:this.AttrModel.f,len:this.AttrModel.f.length,action:function(e){var o,i;switch(e.name){case"unshift":case"push":"unshift"===e.name&&(e.args=Array.from(e.args),e.args.RDMProp=!0,e.args.reverse(),delete e.args.RDMProp);for(var s=0;s<e.args.length;s++)a.ChildDomArr[e.name](new t(a.DomModels,a.Module).setHtmlModelProp(a.ModelProp).setHtmlElementKey(a.HtmlElementKey).setAttrModel(r({},a.AttrModel)).setContinuetoCycle(!1).setForItem(a.Item?r(r({},a.Item),(o={},o[a.AttrModel.itemas]=e.args[s],o)):(i={},i[a.AttrModel.itemas]=e.args[s],i)).setForIndex(a.AttrModel.f.length-(e.args.length-s)).setForLocation({Action:e.name}).setParentDom(a.ParentDom).builder());break;case"pop":0!==a.ChildDomArr.length&&(a.ChildDomArr[a.ChildDomArr.length-1].Dom.parentElement.removeChild(a.ChildDomArr[a.ChildDomArr.length-1].Dom),a.ChildDomArr.pop());break;case"shift":0!==a.ChildDomArr.length&&(a.ChildDomArr[0].Dom.parentElement.removeChild(a.ChildDomArr[0].Dom),a.ChildDomArr.shift());break;case"reverse":case"sort":for(s=0;s<a.ChildDomArr.length;s++)a.ChildDomArr[s].Item[a.AttrModel.itemas]=a.AttrModel.f[s],a.ChildDomArr[s].setLoadState(!0).builder(!0)}for("SELECT"===a.ParentDom.nodeName&&(a.ParentDom.value=""),s=0;s<a.ChildDomArr.length;s++)a.ChildDomArr[s].Index=s;n.default.$DomForTempLate[l].len=a.AttrModel.f.length}});for(var d=0;d<this.AttrModel.f.length;d++)this.ChildDomArr.push(new t(this.DomModels,this.Module).setHtmlModelProp(this.ModelProp).setHtmlElementKey(this.HtmlElementKey).setAttrModel(r({},this.AttrModel)).setContinuetoCycle(!1).setForItem(this.Item?r(r({},this.Item),(o={},o[this.AttrModel.itemas]=this.AttrModel.f[d],o)):(s={},s[this.AttrModel.itemas]=this.AttrModel.f[d],s)).setForIndex(d).setParentDom(this.ParentDom).builder());return this.ChildDomArr}if(e||(this.Dom=document.createElement(this.HtmlElementKey.replace(/_/g,"").replace(/[0-9]/g,""))),this.DecorateDomAttr(),"#comment"!==this.ParentDom.nodeName&&!e){switch(this.ForLocation.Action){case"unshift":0===this.ParentDom.children.length?this.ParentDom.appendChild(this.Dom):this.ParentDom.insertBefore(this.Dom,this.ParentDom.children[0]);break;case"push":default:this.ParentDom.appendChild(this.Dom)}this.ForLocation.Action=""}return e||this.DomModels.push(this),this},t}();e.default=s},152:function(t,e){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.Bind=e.GetValueByPropStr=e.IsForTagModel=e.IsTagModel=void 0,e.IsTagModel=function(t){return"object"===o(t)&&!t.hasOwnProperty("Bind")&&!t.hasOwnProperty("Prop")&&!Array.isArray(t)},e.IsForTagModel=function(t){return!!t.f},e.GetValueByPropStr=function(t,e,o){void 0===o&&(o=!1),t.match(/\<.*?\>/gi)&&(t=t.substring(1,t.length-1));var r={key:"",Item:null};return t.split(".").forEach((function(t){var o=t.match(/\[[0-9]+\]/gi);if(o)return o[0]=o[0].substring(1,o[0].length-1),e=(e=e[t.replace("["+o[0]+"]","")])[o[0]],r.Item=e,void(r.key=t.replace("["+o[0]+"]",""));r.key=t,r.Item=e,e=e[t]})),o?{model:e,Prop:r,BindStr:t}:e},e.Bind=function(t){return{Bind:t}}},475:function(t,e,o){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0});var i=o(63),n=function(){function t(t){var e=this;this.$DomModels=[],this.$Document=document.createDocumentFragment(),this.LazyUpdate=0,this.LaterUpadte=0,this.$Module=new t,this.RanderHTMLModel(this.$Module.Rander(),this.$Document),setTimeout((function(){e.Monitor(e.$Module),e.RewritingArrayFunc()}),0),document.body.appendChild(this.$Document)}return t.prototype.AopFunc=function(e){var o=this;return function(){if(e.apply(this,arguments),!this.RDMProp){"reverse"!==e.name&&"sort"!==e.name||(this["$__"+e.name]=!0);for(var i=0;i<t.$DomForTempLate.length;i++)if(t.$DomForTempLate[i].arr.length!==t.$DomForTempLate[i].len||t.$DomForTempLate[i].arr["$__"+e.name]){for(var n=0;n<arguments.length;n++)"object"===r(arguments[n])&&o.Monitor(arguments[n]);t.$DomForTempLate[i].action({name:e.name,args:arguments})}"reverse"!==e.name&&"sort"!==e.name||delete this["$__"+e.name],o.LazyUpdate&&clearTimeout(o.LazyUpdate),o.LazyUpdate=setTimeout((function(){for(var t=0;t<o.$DomModels.length;t++)o.$DomModels[t].setLoadState(!0).DiffAttrModel()}),1)}}},t.prototype.RewritingArrayFunc=function(){this.$DomModels.RDMProp=!0;for(var t=["push","pop","shift","unshift","sort","reverse"],e=0;e<t.length;e++)Array.prototype[t[e]]=this.AopFunc(Array.prototype[t[e]])},t.prototype.Monitor=function(t){var e=this;if(Array.isArray(t))for(var o=0;o<t.length;o++)this.Monitor(t[o]);else{var i=function(o){var i=t[o];Object.defineProperty(t,o,{get:function(){return i},set:function(t){i=t,e.LaterUpadte&&clearTimeout(e.LaterUpadte),e.LaterUpadte=setTimeout((function(){for(var t=0;t<e.$DomModels.length;t++)e.$DomModels[t].setLoadState(!0).DiffAttrModel()}),1)}}),"object"===r(t[o])&&n.Monitor(t[o])},n=this;for(var s in t)i(s)}},t.prototype.RanderHTMLModel=function(t,e){for(var o in t)new i.default(this.$DomModels,this.$Module).setHtmlModelProp([o]).setHtmlElementKey(o).setAttrModel(t[o]).setParentDom(e).builder()},t.$DomForTempLate=[],t}();e.default=n,n.$DomForTempLate.RDMProp=!0},358:function(t,e,o){var r=o(475),i=o(988);new r.default(i.default)},988:function(t,e,o){Object.defineProperty(e,"__esModule",{value:!0});var r=o(152),i=function(){function t(){this.name="原文本",this.data=[],this.data2=[{name:Math.random().toString(),value:"a"},{name:Math.random().toString(),value:"b"},{name:Math.random().toString(),value:"c"}],this.color="red",this.selectVal="张三",this.EditIndex=0;for(var t=0;t<1e3;t++){var e=Math.random().toString();this.data.push({name:e,age:18})}this.data2[0].name="前缀"}return t.prototype.Rander=function(){var t=this;return{input:{if:0!==this.data2.length,type:"text",value:r.Bind("data2["+this.EditIndex+"].name")},div:{title:"select选中的值："+this.selectVal},select:{value:r.Bind("selectVal"),option:{f:this.data2,itemas:"m",title:"<m.name>",value:"<m.value>"}},button:{title:"test",click:function(){var e;(e=t.data).unshift.apply(e,[{name:"我是unshift的"+Math.random(),age:18},{name:"我是unshift的"+Math.random(),age:18}])}},div1:{style:"color:"+this.color,title:"点我追加Dom",click:function(){t.data2.push({name:"我是追加的"+Math.random(),value:Math.random().toString()})}},a:{title:this.name,div:{f:this.data,itemas:"m",title:this.data2[0].name+"：<m.name> 年龄：<m.age>",input:{value:r.Bind("<m.name>")},click:function(){t.data.reverse()},div:{title:"<m1.name>",f:this.data2,itemas:"m1",click:function(e,o){t.EditIndex=o}}}}}},t}();e.default=i}},e={};!function o(r){if(e[r])return e[r].exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,o),i.exports}(358)}();
//# sourceMappingURL=main-bundle.js.map